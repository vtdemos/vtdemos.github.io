(this["webpackJsonp@login-with-metamask/frontend"]=this["webpackJsonp@login-with-metamask/frontend"]||[]).push([[0],{196:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},199:function(e,t,n){e.exports=n(466)},200:function(e,t,n){},207:function(e,t,n){},209:function(e,t,n){},221:function(e,t){},244:function(e,t){},246:function(e,t){},322:function(e,t){},324:function(e,t){},356:function(e,t){},361:function(e,t){},363:function(e,t){},370:function(e,t){},383:function(e,t){},462:function(e,t,n){},466:function(e,t,n){"use strict";n.r(t);n(200);var a=n(191),o=n(10),r=n.n(o),i=n(192),c=n.n(i),s=n(3),u=n(6),l=n(9),h=n(8),d=(n(207),n(21)),p=n.n(d),m=n(101),g=(n(209),n(193)),f=n.n(g),b=void 0,w=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={loading:!1},e.handleAuthenticate=function(e){var t=e.publicAddress,n=e.signature;return fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/auth"),{body:JSON.stringify({publicAddress:t,signature:n}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){return e.json()}))},e.handleClick=Object(m.a)(p.a.mark((function t(){var n,a,o;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props.onLoggedIn,window.ethereum){t.next=4;break}return window.alert("Please install MetaMask first."),t.abrupt("return");case 4:if(b){t.next=15;break}return t.prev=5,t.next=8,window.ethereum.enable();case 8:b=new f.a(window.ethereum),t.next=15;break;case 11:return t.prev=11,t.t0=t.catch(5),window.alert("You need to allow MetaMask."),t.abrupt("return");case 15:return t.next=17,b.eth.getCoinbase();case 17:if(a=t.sent){t.next=21;break}return window.alert("Please activate MetaMask first."),t.abrupt("return");case 21:o=a.toLowerCase(),e.setState({loading:!0}),fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users?publicAddress=").concat(o)).then((function(e){return e.json()})).then((function(t){return t.length?t[0]:e.handleSignup(o)})).then(e.handleSignMessage).then(e.handleAuthenticate).then(n).catch((function(t){window.alert(t),e.setState({loading:!1})}));case 24:case"end":return t.stop()}}),t,null,[[5,11]])}))),e.handleSignMessage=function(){var e=Object(m.a)(p.a.mark((function e(t){var n,a,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.publicAddress,a=t.nonce,e.prev=1,e.next=4,b.eth.personal.sign("I am signing my one-time nonce: ".concat(a),n,"");case 4:return o=e.sent,e.abrupt("return",{publicAddress:n,signature:o});case 8:throw e.prev=8,e.t0=e.catch(1),new Error("You need to sign the message to be able to log in.");case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),e.handleSignup=function(e){return fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users"),{body:JSON.stringify({publicAddress:e}),headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){return e.json()}))},e}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state.loading;return r.a.createElement("div",null,r.a.createElement("p",null,"Please select your login method.",r.a.createElement("br",null),"For the purpose of this demo, only MetaMask login is implemented."),r.a.createElement("button",{className:"Login-button Login-mm",onClick:this.handleClick},e?"Loading...":"Login with MetaMask"),r.a.createElement("button",{className:"Login-button Login-fb",disabled:!0},"Login with Facebook"),r.a.createElement("button",{className:"Login-button Login-email",disabled:!0},"Login with Email"))}}]),n}(r.a.Component),k=(n(462),n(102)),v=n(195),y=n.n(v),E=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={loading:!1,user:void 0,username:""},e.handleChange=function(t){var n=t.target.value;e.setState({username:n})},e.handleSubmit=function(){var t=e.props.auth.accessToken,n=e.state,a=n.user,o=n.username;e.setState({loading:!0}),a?fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users/").concat(a.id),{body:JSON.stringify({username:o}),headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},method:"PATCH"}).then((function(e){return e.json()})).then((function(t){return e.setState({loading:!1,user:t})})).catch((function(t){window.alert(t),e.setState({loading:!1})})):window.alert("The user id has not been fetched yet. Please try again in 5 seconds.")},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.auth.accessToken,n=Object(k.a)(t).payload.id;fetch("".concat("https://login-with-metamask-backend.herokuapp.com/api","/users/").concat(n),{headers:{Authorization:"Bearer ".concat(t)}}).then((function(e){return e.json()})).then((function(t){return e.setState({user:t})})).catch(window.alert)}},{key:"render",value:function(){var e=this.props,t=e.auth.accessToken,n=e.onLoggedOut,a=Object(k.a)(t).payload.publicAddress,o=this.state,i=o.loading,c=o.user,s=c&&c.username;return r.a.createElement("div",{className:"Profile"},r.a.createElement("p",null,"Logged in as ",r.a.createElement(y.a,{seed:a})),r.a.createElement("div",null,"My username is"," ",s?r.a.createElement("pre",null,s):"not set."," My publicAddress is ",r.a.createElement("pre",null,a)),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"username"},"Change username: "),r.a.createElement("input",{name:"username",onChange:this.handleChange}),r.a.createElement("button",{disabled:i,onClick:this.handleSubmit},"Submit")),r.a.createElement("p",null,r.a.createElement("button",{onClick:n},"Logout")))}}]),n}(r.a.Component),O=n(196),S=n.n(O),j="login-with-metamask:auth",L=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={},e.handleLoggedIn=function(t){localStorage.setItem(j,JSON.stringify(t)),e.setState({auth:t})},e.handleLoggedOut=function(){localStorage.removeItem(j),e.setState({auth:void 0})},e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=window.localStorage.getItem(j),t=e&&JSON.parse(e);this.setState({auth:t})}},{key:"render",value:function(){var e=this.state.auth;return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:S.a,className:"App-logo",alt:"logo"}),r.a.createElement("h1",{className:"App-title"},"Welcome to Login with MetaMask Demo")),r.a.createElement("div",{className:"App-intro"},e?r.a.createElement(E,{auth:e,onLoggedOut:this.handleLoggedOut}):r.a.createElement(w,{onLoggedIn:this.handleLoggedIn})))}}]),n}(r.a.Component);Object(a.config)({path:".env.production"}),c.a.render(r.a.createElement(L,null),document.getElementById("root"))}},[[199,1,2]]]);
//# sourceMappingURL=main.675e6e60.chunk.js.map
